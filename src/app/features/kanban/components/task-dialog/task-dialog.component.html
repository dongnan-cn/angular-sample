<div class="task-dialog">
  <!-- 对话框标题 -->
  <h2 mat-dialog-title class="dialog-title">
    <mat-icon class="title-icon">{{ isEditMode() ? 'edit' : 'add_task' }}</mat-icon>
    {{ isEditMode() ? '编辑任务' : '创建任务' }}
  </h2>

  <!-- 对话框内容 -->
  <mat-dialog-content class="dialog-content">
    <form [formGroup]="taskForm" class="task-form">
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>任务标题</mat-label>
        <input matInput formControlName="title" placeholder="请输入任务标题">
        <mat-error *ngIf="taskForm.get('title')?.hasError('required')">
          任务标题不能为空
        </mat-error>
        <mat-error *ngIf="taskForm.get('title')?.hasError('maxlength')">
          任务标题不能超过100个字符
        </mat-error>
      </mat-form-field>

      <!-- 任务描述 -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>任务描述</mat-label>
        <textarea 
          matInput 
          formControlName="description" 
          placeholder="请输入任务描述"
          rows="4">
        </textarea>
        <mat-error *ngIf="taskForm.get('description')?.hasError('maxlength')">
          任务描述不能超过1000个字符
        </mat-error>
      </mat-form-field>

      <!-- 任务类型和优先级 -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>任务类型</mat-label>
          <mat-select formControlName="type">
            <mat-option value="STORY">用户故事</mat-option>
            <mat-option value="TASK">任务</mat-option>
            <mat-option value="BUG">缺陷</mat-option>
            <mat-option value="EPIC">史诗</mat-option>
          </mat-select>
          <mat-error *ngIf="taskForm.get('type')?.hasError('required')">
            请选择任务类型
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>优先级</mat-label>
          <mat-select formControlName="priority">
            <mat-option value="LOWEST">
              <span class="priority-option lowest">最低</span>
            </mat-option>
            <mat-option value="LOW">
              <span class="priority-option low">低</span>
            </mat-option>
            <mat-option value="MEDIUM">
              <span class="priority-option medium">中等</span>
            </mat-option>
            <mat-option value="HIGH">
              <span class="priority-option high">高</span>
            </mat-option>
            <mat-option value="HIGHEST">
              <span class="priority-option highest">最高</span>
            </mat-option>
          </mat-select>
          <mat-error *ngIf="taskForm.get('priority')?.hasError('required')">
            请选择优先级
          </mat-error>
        </mat-form-field>
      </div>

      <!-- 预估工时和截止日期 -->
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>预估工时（小时）</mat-label>
          <input 
            matInput 
            type="number" 
            formControlName="estimatedHours" 
            placeholder="0"
            min="0"
            step="0.5">
          <mat-error *ngIf="taskForm.get('estimatedHours')?.hasError('min')">
            预估工时不能为负数
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>截止日期</mat-label>
          <input 
            matInput 
            [matDatepicker]="dueDatePicker" 
            formControlName="dueDate"
            placeholder="选择截止日期">
          <mat-datepicker-toggle matSuffix [for]="dueDatePicker"></mat-datepicker-toggle>
          <mat-datepicker #dueDatePicker></mat-datepicker>
        </mat-form-field>
      </div>

      <!-- 表单验证状态显示 -->
      <div class="form-status" *ngIf="taskForm.invalid && taskForm.touched">
        <mat-icon class="error-icon">error</mat-icon>
        <span>请检查并修正表单中的错误</span>
      </div>
    </form>
  </mat-dialog-content>

  <!-- 对话框操作按钮 -->
  <mat-dialog-actions class="dialog-actions">
    <button mat-button (click)="onCancel()" class="cancel-btn">
      取消
    </button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSave()"
      [disabled]="taskForm.invalid || loading()"
      class="save-btn">
      <mat-icon *ngIf="loading()">hourglass_empty</mat-icon>
      {{ isEditMode() ? '更新' : '创建' }}
    </button>
  </mat-dialog-actions>
</div>